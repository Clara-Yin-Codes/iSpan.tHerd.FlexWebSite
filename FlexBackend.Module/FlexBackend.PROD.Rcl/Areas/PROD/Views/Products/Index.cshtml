@using System.Text.Json
@using FlexBackend.Core.DTOs.PROD
@using FlexBackend.UIKit.Rcl.Views.Shared.Components.DataTable
@model IEnumerable<ProdProductDto>

@{
    ViewData["Title"] = "商品管理";
}

@{
    // 1) 資料 → JSON（保留 PascalCase）
    var dataJson = JsonSerializer.Serialize(
        Model ?? Enumerable.Empty<ProdProductDto>(),
        new JsonSerializerOptions { PropertyNamingPolicy = null }
    );

    // 2) 欄位定義（第一欄為 dt-control，縮窄寬度）
    var columns = new List<Dictionary<string, object?>> {
        new() {
            ["className"] = "dt-control",
            ["orderable"] = false,
            ["data"] = null,
            ["defaultContent"] = "",
            ["width"] = "8px"
        },
        new() { ["data"] = "ProductId" },
        new() { ["data"] = "SupplierId" },
        new() { ["data"] = "BrandId" },
        new() { ["data"] = "ProductName" },
        new() { ["data"] = "IsPublished" },
        new() { ["data"] = "Creator" },
        new() { ["data"] = "CreatedDate" }
    };
    var columnsJson = JsonSerializer.Serialize(columns);

    // 3) ViewModel
    var vm = new DataTableViewModel
    {
        TableId = "ProductsTable",
        Headers = new[] { "", "商品編號", "供應商", "品牌", "商品名稱", "上架", "建檔人員", "建檔日期" },
        ColumnsJson = columnsJson,
        DataJson = dataJson,
        EnableChildRow = true,
        PageLength = 10,
        LengthMenu = new[] { 5, 10, 25, 50 },
        FixedLeftColumns = 1,
        FixedRightColumns = 0
    };
}
@await Component.InvokeAsync("DataTable", vm)
